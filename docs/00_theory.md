# LTC-NCP-VA 理论基础

## 1. 液态时间常数（Liquid Time Constant）

### 1.1 数学基础

液态时间常数（LTC）单元是一种连续时间递归神经网络。其核心思想是让隐状态满足一阶常微分方程（ODE）：

$$\frac{dh(t)}{dt} = -\frac{1}{\tau(t)}h(t) + \frac{1}{\tau(t)}(W_x x(t) + W_h \sigma(h(t)) + b)$$

其中：
- $h(t)$ 是隐状态
- $\tau(t)$ 是可学习的时间常数，控制系统响应速度
- $W_x$ 是输入权重矩阵
- $W_h$ 是隐状态权重矩阵
- $\sigma$ 是非线性激活函数（本实现中使用tanh）
- $b$ 是偏置项

在离散时间步上，使用数值积分方法求解ODE：

**欧拉法**：
$$h_{t+1} = h_t + \frac{\Delta t}{\tau_t} \left( -h_t + W_x x_t + W_h \sigma(h_t) + b \right)$$

**四阶龙格-库塔法（RK4）**：提供更高精度的数值解，但计算成本更高：
$$k_1 = \frac{-h_t + W_x x_t + W_h \sigma(h_t) + b}{\tau_t}$$
$$k_2 = \frac{-(h_t + \frac{\Delta t}{2}k_1) + W_x x_t + W_h \sigma(h_t + \frac{\Delta t}{2}k_1) + b}{\tau_t}$$
$$k_3 = \frac{-(h_t + \frac{\Delta t}{2}k_2) + W_x x_t + W_h \sigma(h_t + \frac{\Delta t}{2}k_2) + b}{\tau_t}$$
$$k_4 = \frac{-(h_t + \Delta t k_3) + W_x x_t + W_h \sigma(h_t + \Delta t k_3) + b}{\tau_t}$$
$$h_{t+1} = h_t + \frac{\Delta t}{6}(k_1 + 2k_2 + 2k_3 + k_4)$$

### 1.2 LTC的优势

相比传统RNN，LTC具有以下优势：

1. **可变时间分辨率**：通过学习$\tau$，模型能自适应地调整信息流动速度
2. **长期依赖性**：缓解传统RNN中的梯度消失/爆炸问题
3. **生物合理性**：更接近生物神经元的动力学行为
4. **连续时间建模**：更适合对连续时间序列进行建模

## 2. 神经电路策略（Neural Circuit Policy）

### 2.1 设计理念

NCP连线策略的灵感来自生物神经系统，特别是线虫（C. elegans）神经回路的结构：

1. **三层架构**：
   - 传感神经元层（输入）
   - 中间神经元层（处理）
   - 运动神经元层（输出）

2. **稀疏连接**：与全连接网络不同，NCP仅保留关键连接，减少参数数量

3. **结构规律性**：遵循特定的连接模式，增强可解释性

### 2.2 数学实现

在本实现中，NCP通过创建稀疏连接掩码实现：

$$M_{i,j} = \begin{cases} 
1 & \text{如果存在从神经元 } i \text{ 到神经元 } j \text{ 的连接} \\
0 & \text{否则}
\end{cases}$$

然后将掩码应用于权重矩阵：

$$W_{effective} = W \odot M$$

其中$\odot$表示元素级乘法。

稀疏性水平由参数$s \in [0,1]$控制，连接概率为$p = 1-s$。

## 3. LTC-NCP 融合架构

### 3.1 整体结构

LTC-NCP-VA模型将LTC细胞与NCP连线策略融合，形成结构如下：

1. **词嵌入层**：将输入tokens映射为嵌入向量
2. **NCP-LTC层**：将LTC细胞的连接按照NCP策略进行稀疏化
3. **输出层**：将最终隐状态映射为VA值（[-1,1]范围内）

### 3.2 元特征增强

模型还可选择性地利用元特征：
- 句长特征：捕捉文本长度与情感强度的关系
- 标点密度：捕捉标点符号与情感表达的关系

这些特征在最终隐状态后拼接，提供额外的非语义信息。

## 4. 训练与评估

### 4.1 损失函数

模型使用均方误差（MSE）损失：

$$L = \frac{1}{N} \sum_{i=1}^N \sum_{j \in \{V,A\}} (y_{ij} - \hat{y}_{ij})^2$$

### 4.2 评估指标

主要评估指标为一致性相关系数（CCC）：

$$\rho_c = \frac{2\rho\sigma_y\sigma_{\hat{y}}}{\sigma_y^2 + \sigma_{\hat{y}}^2 + (\mu_y - \mu_{\hat{y}})^2}$$

其中：
- $\rho$ 是Pearson相关系数
- $\sigma_y$和$\sigma_{\hat{y}}$是真实值和预测值的标准差
- $\mu_y$和$\mu_{\hat{y}}$是真实值和预测值的均值

CCC能同时考虑相关性和一致性，是情感预测任务中的标准指标。

## 5. 实验设计与分析

### 5.1 积分方法比较

比较欧拉法和RK4方法的性能差异：
- RK4精度更高，但计算成本更大
- 在第15轮后，RK4方法表现更稳定

### 5.2 元特征贡献

通过消融实验验证元特征对性能的提升：
- 添加句长和标点密度特征提升约+0.02 CCC
- 元特征对极端情感样本预测尤其有效

### 5.3 双语泛化能力

评估模型在中英双语环境下的泛化能力：
- 验证共享表示的有效性
- 分析语言特定的情感表达模式 